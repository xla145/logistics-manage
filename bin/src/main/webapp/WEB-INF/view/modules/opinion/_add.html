<#include "../_layout/_layout.html"><#t>
<@header/>
<div class="admin-main">
<div style="margin: 15px;   id="add-form">
	<form class="layui-form">
		<div class="layui-form-item">
			<label class="layui-form-label">运营商:</label>
			<div class="layui-input-inline">
				<input type="text" name="name" placeholder="请输入用户名" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">通道:</label>
			<div class="layui-input-inline">
				 <select name="channelId">
				  <option value=" ">全部</option>
				  <@module name="option" type="self" groupCode="channelGroup" itemCode="1" class="com.cnm.iot.service.dictionary.impl.DictionaryData"/>
				</select> 
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">资费包:</label>
			<div class="layui-input-inline">
				<select name="expensesId" id="expensesId"  lay-filter="expenses">
				  <option value=" ">全部</option>
				  <@module name="option" type="self" groupCode="expensesGroup" itemCode="zftc" class="com.cnm.iot.service.dictionary.impl.DictionaryData"/>
				</select> 
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">单价:</label>
			<div class="layui-input-inline">
				<input type="text" name="price" id="price" readonly="readonly" placeholder="" autocomplete="off" class="layui-input">
			</div>
			<div class="layui-form-mid layui-word-aux">元</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">物联卡数量:</label>
			<div class="layui-input-inline">
				<input type="text" name="flowCardNum" id="flowCardNum" placeholder="" value=1 autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">订购周期:</label>
			<div class="layui-input-inline">
				<select name="orderCycle" id="orderCycle" lay-filter="cycle">
				  <option value=1>1</option>
				  <option value=2>2</option>
				  <option value=3>3</option>
				  <option value=4>4</option>
				  <option value=5>5</option>
				  <option value=6>6</option>
				  <option value=7>7</option>
				  <option value=8>8</option>
				  <option value=9>9</option>
				  <option value=10>10</option>
				  <option value=11>11</option>
				  <option value=12>12</option>
				</select> 
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">总金额:</label>
			<div class="layui-input-inline">
				<input id="amount" type="text" name="amount" readonly="readonly" placeholder="" autocomplete="off" class="layui-input">
			</div>
			<div class="layui-form-mid layui-word-aux">元</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">周期类型:</label>
			<div class="layui-input-inline">
				<span id="">月度</span>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">周期:</label>
			<div class="layui-input-inline">
				<input type="text" name="order" readonly="readonly" placeholder="" autocomplete="off" class="layui-input">
			</div>
			 <div class="layui-form-mid layui-word-aux">天</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">SIM卡号:</label>
			<div class="layui-input-inline">
				<input type="text" name="cardSim" placeholder="请输入SIM卡号" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">开始时间:</label>
			<div class="layui-input-inline">
		        <input type="text" name="startTime" id="startTime" placeholder="yyyy-mm-dd" autocomplete="off" class="layui-input" onclick="layui.laydate({elem: this,choose: function(dates){layui.jquery.get('getEndTime', {startTime:dates,expensesId:layui.jquery('#expensesId').val(),orderCycle:layui.jquery('#orderCycle').val()},function(result){layui.jquery('#endTime').val(result.endTime);})}})">
		      </div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">结束时间:</label>
			<div class="layui-input-inline">
		        <input type="text" readonly="readonly" name="endTime" id="endTime" placeholder="yyyy-mm-dd" autocomplete="off" class="layui-input" >
		      </div>
		</div>
	</form>
</div>
</div>
<@footer>
<script type="text/javascript" src="${assets}js/datagrid.js"></script>
<script>
//入口
layui.use(['form', 'layedit', 'laydate'], function(){
  var form = layui.form()
  ,layer = layui.layer
  ,layedit = layui.layedit
  ,laydate = layui.laydate;
  var $ = layui.jquery;
  
  //创建一个编辑器
  var editIndex = layedit.build('LAY_demo_editor');
 
  //自定义验证规则
  form.verify({
    title: function(value){
      if(value.length < 5){
        return '标题至少得5个字符啊';
      }
    }
    ,pass: [/(.+){6,12}$/, '密码必须6到12位']
    ,content: function(value){
      layedit.sync(editIndex);
    }
  });
  
  
  form.on('select(expenses)', function(data){
	  $.post("/flowcard/flowCardExpenses", { expensesId: data.value},
			   function(result){
		  		
		  		$('#price').val(result.price);
		  		$('#expensesId').val(result.expensesId);
		  		 var toatlAmount = $('#flowCardNum').val() * $('#price').val() * $('#orderCycle option:selected').val() ;
		  		  $('#amount').val(toatlAmount);
			   });
	});      
  
  

  
   form.on('select(cycle)', function(data){
	  var toatlAmount = data.value * $('#price').val() * $('#flowCardNum').val();
	  $('#amount').val(toatlAmount);
	});    
  
  	$("#flowCardNum").change(function(){
  		
  		 var toatlAmount = $('#flowCardNum').val() * $('#price').val() * $('#orderCycle option:selected').val() ;
  		 $('#amount').val(toatlAmount);
	});
  	
  	$("#startTime").change(function(){
  		alert('123456');
  		alert($("#startTime").val());
	});
  	
  	/*
    var getEndTime = function(startTime,expensesId,orderCycle){
  	  $.get("getEndTime", {startTime:startTime,expensesId:expensesId,orderCycle:orderCycle},
  		function(result){
  		alert(result.endTime);
  	//	$('#price').val(result.price);
	   }
  	  )};*/
    
  
});

</script>
</@footer>     