<#include "../_layout/_layout.html"><#t>
<@header/>
<div class="admin-main">
	<!-- 按钮组 -->
	<blockquote class="layui-elem-quote">
		<a href="javascript:void(0)" class="layui-btn layui-btn-small" id="add"><i class="layui-icon">&#xe654;</i> 添加合作商</a>
		<a href="javascript:void(0)" class="layui-btn layui-btn-small layui-btn-normal" id="edit"><i class="layui-icon">&#xe642;</i> 编辑</a>
<!-- 		<a href="javascript:void(0)" class="layui-btn layui-btn-small layui-btn-danger" id="delete"><i class="layui-icon">&#xe640;</i> 停用</a> -->
	</blockquote>
	<!-- 筛选组 -->
	<blockquote class="layui-elem-quote filter-bar">
		<form class="layui-form" action="/table.html" id="filterForm">
		     <div class="layui-inline">
		      <label class="layui-form-label">合作商名称：</label>
			  <div class="layui-input-inline">
		        <input type="text" name="name" class="layui-input">
		      </div>
		    </div>
		    <div class="layui-inline">
		      <label class="layui-form-label">供应商类型：</label>
		      <div class="layui-input-inline">
		        <select name="type">
				  <option value="">全部</option>
				  <#list supplierType as st>
            			<option value="${st.getId()!''}">${st.getName()!''}</option>                 
                  </#list>
				</select> 
		      </div>
		    </div>
		    <div class="layui-inline">
		      <label class="layui-form-label">是否停用：</label>
		      <div class="layui-input-inline">
		        <select name="status">
				  <option value="">全部</option>
				  <option value=0>是</option>
				  <option value=1>否</option>
				</select> 
		      </div>
		    </div>
			<a href="javascript:void(0)" class="layui-btn layui-btn-small" id="search"><i class="layui-icon">&#xe615;</i>搜索</a>
			<a href="javascript:void(0)" class="layui-btn layui-btn-small" id="reset"><i class="layui-icon">&#x1002;</i>重置</a>
		</form>
	</blockquote>
	<!-- 表格区域 -->
	<div class="layui-form" id="twrap">
	  <table class="layui-table lay-even clear-padding" lay-skin="line">
	    <thead>
	      <tr>
	        <th class="ckb"><input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose"></th>
	        <th>序号</th>
	        <th>合作商名称</th>
	        <th>合作商编码</th>
	        <th>合作商类型</th>
	        <th>联系人</th>
	        <th>电话</th>
	        <th>传真</th>
	        <th>网址</th>
	        <th>QQ</th>
	        <th>地址</th>
	        <th>添加时间</th>
	        <th>停用时间</th>
	        <th fixed="right">是否停用</th>
	        <th fixed="right">操作</th>
	      </tr> 
	    </thead>
	    <tbody></tbody>
	  </table>
	  <!-- 分页容器 -->
	  <div class="layui-show"><div id="page"></div></div>
	</div>
</div>
<#include "_add.html"><#t>
<@footer>
<script type="text/javascript" src="${assets}js/datagrid.js"></script>
<script>
//入口
layui.use(['datagrid','laydate'], function(){
  var $ = layui.jquery;
  var form = layui.form(),
  datagrid = layui.datagrid();
  
  //表格数据加载插件，可选参数：
  datagrid.init({
	  url: 'list',
	  pageSize: 15,
	  pageEm: $('#page'),
	  tempEm: $('#twrap'),
	  filterForm: $('#filterForm')
  });
  
  //搜索， 依赖datagrid
  $('#search').bind('click', function(){  
	  datagrid.search();	
  })
  
  //搜索， 依赖datagrid
  $('#reset').bind('click', function(){
	  $("#filterForm")[0].reset(); 
	  datagrid.search();	  
  })
  
  //添加、编辑插件可选配置：
  $('#add').bind('click', function(){
	  datagrid.open({
		  url: 'add',
		  content: $('#add-form'),
		  title: '添加供应商'
	  });
  })
  
  
  $('#edit').bind('click', function(){
	  var ids = datagrid.getCheckedVal();
	  if (ids.length != 1) {
		  layer.msg('请选择一条数据编辑!');
		  return;
	  }
	  editFn(ids[0]);
  })
  
  //删除
  $('#delete').bind('click', function(){
	  var ids = datagrid.getCheckedVal();
	  if (ids.length < 1) {
		  layer.msg('请选择至少一条数据删除!');
		  return;
	  }
	  delFn(ids);
  });
  
//操作
  $('#twrap').on('click', '.operate', function(){
	  var cmd = $(this).attr('data-fn');
	  var id = $(this).siblings('.index-id').val();
	  var type = $(this).siblings('.index-type').val();
	  var status = $(this).siblings('.index-status').val();
	  if (cmd == 'edit') {
		  editFn(id);
	  }
	  if (cmd == 'stop') {
		  changeStatus(id,status);
	  }
	  if (cmd == 'start') {
		  changeStatus(id,status);
	  }
	  if (cmd == 'show-product') {
		  showProduct(type,id);
	  }
  })
  
  //打开编辑框
  var editFn = function(id){
	  console.log(id)
	  if(!id){
		  layer.msg('请选择一条数据编辑!');
		  return;
	  }
	  $.get("editView", {id: id},function(html){
			//打开编辑页
			  datagrid.open({
				  url: 'edit',
				  content: html,
				  title: '编辑供应商'
			  });
		}, "html")
  }
  
//删除数据
  var delFn = function(id,status){
	  if(!id){
		  layer.msg('请选择一条数据删除!');
		  return;
	  }
	  layer.confirm('您确定要停止该供应商？', {icon: 3, title:'提示'}, function(){
		  $.ajax({ 
			type: "POST", 
			url: "changeStatus", 
			data: {'ids':id.toString(),'status':status}, 
			success: function(json) { 
				if (json.code == -1){
					layer.msg(json.msg);
				} else{
					layer.msg("改变状态成功！",{time:500});
					datagrid.search();
				}	
			} 
		 });
	  });  
  }
  
//显示商品信息
  var showProduct = function(type,id){
	 var url ="productIndex?id="+id+"&type="+type;
	  layer.open({
	      type: 2,
	      title: '查看产品信息',
	      shadeClose: true,
	      shade: false,
	      maxmin: true, //开启最大化最小化按钮
	      area: ['893px', '600px'],
	      content: url
	  }); 
  }
  
  var changeStatus = function(id,status){
	  
	  
	  if(!id){
		  layer.msg('请选择一条数据删除!');
		  return;
	  }
	  layer.confirm('您确定要停止该供应商？', {icon: 3, title:'提示'}, function(){
		  $.ajax({ 
			type: "POST", 
			url: "changeStatus", 
			data: {'ids':id.toString(),'status': status}, 
			success: function(json) { 
				if (json.code == -1){
					layer.msg(json.msg);
				} else{
					layer.msg("停止成功！",{time:500});
					datagrid.search();
				}	
			} 
		 });
	  });  
  }
});
</script>
</@footer>        