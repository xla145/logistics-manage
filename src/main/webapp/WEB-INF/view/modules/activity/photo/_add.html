<#include "../../../_layout/_layout.html"><#t>
<@header>
<link rel="stylesheet" type="text/css" href="${assets}plugins/webuploader-0.1.5/webuploader.css">
<link rel="stylesheet" type="text/css" href="${assets}plugins/webuploader-0.1.5/style.css">
</@header>
<div id="form-save" style="margin: 15px;">
	<form class="layui-form">
		<#if data.id??>
			<div class="layui-form-item">
				<label class="layui-form-label layui-title">链接地址：</label>
				<div class="layui-form-mid">${data.url!''}</div>
			</div>
		</#if>
		<div class="layui-form-item">
			<label class="layui-form-label layui-title">历史活动标题：</label>
			<div class="layui-input-inline">
				<input type="text" name="title" autocomplete="off" class="layui-input" lay-verify="required" value="${data.title!''}">
			    <input value="${data.id!''}" type="hidden" name="id" id="did">
			</div>
			<div class="layui-form-mid layui-word-aux">*</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">活动时间:</label>
			<div class="layui-input-inline">
				<#if data.activityTime??>
					<input type="text" name="activityTime"  lay-verify="required" value="${data.activityTime?string('yyyy-MM-dd HH:mm:ss')}" autocomplete="off" class="layui-input" onclick="layui.laydate({elem: this,istime: true,format:'YYYY-MM-DD hh:mm:ss'})" >
					<#else>
						<input type="text" name="activityTime"  lay-verify="required" autocomplete="off" class="layui-input" onclick="layui.laydate({elem: this,istime: true,format:'YYYY-MM-DD hh:mm:ss'})" >
				</#if>
			</div>
			<div class="layui-form-mid layui-word-aux">*</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">活动地点：</label>
			<div class="layui-input-inline">
				<input type="text" name="addr" autocomplete="off" class="layui-input" lay-verify="required" value="${data.addr!''}">
			</div>
			<div class="layui-form-mid layui-word-aux">*</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">链接有效期：</label>
			<div class="layui-input-inline">
				<#if data.expireTime??>
					<input type="text" name="expireTime"  lay-verify="required" value="${data.expireTime?string('yyyy-MM-dd HH:mm:ss')}" autocomplete="off" class="layui-input" onclick="layui.laydate({elem: this,istime: true,min: laydate.now(),format:'YYYY-MM-DD hh:mm:ss'})" >
					<#else>
					<input type="text" name="expireTime"  lay-verify="required" autocomplete="off" class="layui-input" onclick="layui.laydate({elem: this,istime: true,min: laydate.now(),format:'YYYY-MM-DD hh:mm:ss'})" >
				</#if>
			</div>
			<div class="layui-form-mid layui-word-aux">*</div>
		</div>
		<#if data.author??>
			<div class="layui-form-item">
				<label class="layui-form-label layui-title">发布时间：</label>
				<div class="layui-form-mid">
					<#if data.releaseTime??>
					    ${data.releaseTime?string("yyyy-MM-dd HH:mm:ss")}
				    </#if>
				</div>
				<label class="layui-form-label layui-title">操作人：</label>
				<div class="layui-form-mid">${data.author!''}</div>
				<label class="layui-form-label layui-title">图片张数：</label>
				<div class="layui-form-mid">${data.number!''}</div>
			</div>
		</#if>
		<div class="layui-form-item">
			<label class="layui-form-label">图片信息：</label>
			<div class="layui-input-block product-info">
				<p style="display: none" id="photo-json">${data.imgJson!''}</p>
				<div id="wrapper">
					<div id="container">
						<!--头部，相册选择和格式选择-->
						<div id="uploader">
							<div class="queueList">
								<div id="dndArea" class="placeholder">
									<div id="filePicker"></div>
									<p>或将照片拖到这里，单次最多可选300张</p>
								</div>
							</div>
							<div class="statusBar" style="display:none;">
								<div class="progress">
									<span class="text">0%</span>
									<span class="percentage"></span>
								</div><div class="info"></div>
								<div class="btns">
									<div id="filePicker2"></div><div class="uploadBtn">开始上传</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn" type="button" id="submit">立即提交</button>
				<button class="layui-btn layui-btn-primary" id="cancel">取消</button>
			</div>
		</div>
	</form>
</div>
<@footer>
<script type="text/javascript" src="${assets}js/jquery.js"></script>
<script type="text/javascript" src="${assets}plugins/webuploader-0.1.5/webuploader.js"></script>
<script type="text/javascript" src="${assets}plugins/webuploader-0.1.5/upload.js"></script>
<script>
	//入口
	layui.use(['laydate','form'], function() {
		var $ = layui.jquery;
		var form = layui.form();
		var json = $("#photo-json").text();
//		var json = ${data.imgJson!''};
		var urls = [];
		if (json != ""){
            $.each(JSON.parse(json),function(i,item){
                urls.push(item.url);
            });
            showFile(urls);
		}
		$("#submit").on('click', function(){
            //给轮播图片的隐藏表单设置name
            $("#uploader .queueList ul li").each(function (index,element) {
                $(this).find("input").attr("name",'activityDisplayImgsList['+ (index) +'].url')
            });
            var id = $("#did").val();
            var url = "add";
            if(id != "") {
                url = "edit"
            }
            var formEm = $("#form-save").find('form');
			$.post(url,formEm.serialize(),function(result){
				if(result.code == 0){
					formEm[0].reset();	//清空弹框表单内容
					var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);
					parent.tools.searchData();
				}
				layer.msg(result.msg);
			});
		});
		$("#cancel").on('click',function () {
            $("#form-save").find('form')[0].reset();
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);
        });
	});
</script>
</@footer>
<style>
	body{
		font-size: 13px;
	}
	.layui-input-inline span{
		line-height:38px;
	}
	.layui-form-label {
		width: 90px;
	}
	.layui-title{
		width: 91px;
	}
	.layui-word-aux{
		color: red;
	}
</style>