<#include "_layout/_layout2.0.html"><#t>
<@header>
    <link rel="stylesheet" href="${assets}css/main.css" media="all" />
</@header>
    <div id="layui-main">
        <div class="panel_box layui-row layui-col-space10">
            <div class="panel_1 layui-col-md3">
                <a href="javascript:;" data-url="page/user/allUsers.html">
                    <div class="panel_icon" style="background-color:#2f8ca7;">
                        <i class="layui-icon icon-dollar" data-icon="icon-supplierfeatures"></i>
                    </div>
                    <div class="panel_word product-stock">
                        <span>100000.00</span>
                        <cite>总收入</cite>
                    </div>
                </a>
            </div>
            <div class="panel_1 layui-col-md3">
                <a href="javascript:;" data-url="page/user/allUsers.html">
                    <div class="panel_icon" style="background-color:#FF5722;">
                        <i class="layui-icon icon-productfeatures" data-icon="icon-supplierfeatures"></i>
                    </div>
                    <div class="panel_word product-stock">
                        <span>100</span>
                        <cite>存货总数</cite>
                    </div>
                </a>
            </div>
            <div class="panel_1 layui-col-md3">
                <a href="javascript:;" data-url="page/user/allUsers.html">
                    <div class="panel_icon" style="background-color:#009688;">
                        <i class="layui-icon icon-machinery" data-icon="icon-machinery"></i>
                    </div>
                    <div class="panel_word sum-purchase">
                        <span>100</span>
                        <cite>采购单总数</cite>
                    </div>
                </a>
            </div>
            <div class="panel_1 layui-col-md3">
                <a href="javascript:;" data-url="page/img/images.html">
                    <div class="panel_icon" style="background-color:#5FB878;">
                        <i class="layui-icon icon-store" data-icon="icon-store"></i>
                    </div>
                    <div class="panel_word sum-sales">
                        <span>1000</span>
                        <cite>销售单总数</cite>
                    </div>
                </a>
            </div>
        </div>
        <div class="layui-row layui-col-space10">
            <div class="sysNotice layui-col-md6">
                <div class="layui-collapse" lay-accordion>
                    <h2 class="layui-colla-title">产品分布</h2>
                    <div class="layui-colla-item">
                        <div class="layui-colla-content layui-show" id="member-text" style="width: 90%;height: 400px;margin: 0px auto;"></div>
                    </div>
                </div>
            </div>
            <div class="sysNotice layui-col-md6">
                <div class="layui-collapse" lay-accordion>
                    <h2 class="layui-colla-title">采购单</h2>
                    <div class="layui-colla-item">
                        <div class="layui-colla-content layui-show" id="order-text" style="width: 90%;height: 400px;margin: 0px auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<@footer>
<script src="${assets}echarts/echarts.min.js" type="text/javascript"></script>
<script>
    layui.use(['layer','element'], function() {

        var websocket = null;
        //判断浏览器是否支持websocket
        if('WebSocket' in window) {
            websocket = new WebSocket("ws://localhost:8080/hello");
        }else{
            console.log("该浏览器不支持实时通信功能");
        }

        websocket.onopen= function() {
            console.log("websocket连接成功");
        }

        websocket.onclose= function() {
            console.log("websocket连接关闭");
        }


        var $ = layui.jquery;
        var layer = layui.layer, element = layui.element;
        //操作
        var active = {

        }
        //绑定操作按钮
        $('.operator-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

        websocket.onmessage= function(event) {
            var json = JSON.parse(event.data);
            $(".product-stock span").text(json.sumRemaining);
            $(".sum-sales span").text(json.sumSales);
            $(".sum-purchase span").text(json.sumPurchase);
        }


//        // 基于准备好的dom，初始化echarts实例
        var member = echarts.init(document.getElementById('member-text'));

        var order = echarts.init(document.getElementById('order-text'));



        // 指定图表的配置项和数据
        var option_1 = {
            tooltip: {},
            legend: {
                data:[{name:'采购'},{name:'销售'}]
            },
            xAxis: {
                data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
            },
            yAxis: {},
            series: [{
                name: '采购',
                type: 'line',
                data: [10, 50, 100, 150, 100, 150]
            },{
                name: '销售',
                type: 'line',
                data: [5, 20, 50, 50, 70, 100]
            }]
        };


        var option_2 = {
            color: ['#3398DB'],
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    data : ['广州50号', '广州40号', '广州30号', '广州20号', '广西1号' ],
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'产品数量',
                    type:'bar',
                    barWidth: '60%',
                    data:[10, 52, 200, 334, 390]
                }
            ]
        };

//        // 使用刚指定的配置项和数据显示图表。
        order.setOption(option_1);

        member.setOption(option_2);


    });
</script>
</@footer>
