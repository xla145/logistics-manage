<#include "../../../_layout/_layout2.0.html"><#t>
<@header/>
<div id="form-save" style="margin: 15px;">
	<form class="layui-form layui-form-pane">
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>商品标题：</label>
			<div class="layui-input-block">
				<input type="text" name="title" placeholder="请输入商品标题" autocomplete="off" class="layui-input" lay-verify="required" value="${data.title!''}">
				<input type="hidden" value="${data.pid!''}" name="pid" id="pid">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>商品名称：</label>
			<div class="layui-input-inline">
				<input type="text" name="name" placeholder="请输入商品名称" autocomplete="off" class="layui-input" lay-verify="required" value="${data.name!''}">
			</div>
			<label class="layui-form-label"><span>*</span>价格：</label>
			<div class="layui-input-inline">
				<#if data.price??>
					<input type="text" name="price" placeholder="请输入商品价格" autocomplete="off" class="layui-input" lay-verify="required" value="${data.price?string('#.##')}">
				<#else>
					<input type="text" name="price" placeholder="请输入商品价格" autocomplete="off" class="layui-input" lay-verify="required">
				</#if>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">进货价：</label>
			<div class="layui-input-inline">
				<#if data.originalPrice??>
					<input type="text" name="originalPrice" placeholder="请输入进货价" autocomplete="off" class="layui-input" value="${data.originalPrice?string('#.##')}">
					<#else>
					<input type="text" name="originalPrice" placeholder="请输入进货价" autocomplete="off" class="layui-input" >
				</#if>
			</div>
			<label class="layui-form-label">包装单位：</label>
			<div class="layui-input-inline">
				<input type="text" name="unit" placeholder="请输入包装单位" autocomplete="off" class="layui-input" value="${data.unit!''}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">配送方式：</label>
			<div class="layui-input-inline">
				<input type="text" name="delivery" placeholder="请输入配送方式" autocomplete="off" class="layui-input" value="快递配送">
			</div>
			<label class="layui-form-label">销量：</label>
			<div class="layui-input-inline">
				<input type="text" name="sales" placeholder="请输入销量" autocomplete="off" class="layui-input" value="${data.sales!''}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">运费：</label>
			<div class="layui-input-inline">
				<input type="text" name="freight" placeholder="请输入运费" autocomplete="off" class="layui-input" value="${data.freight!''}">
			</div>
			<label class="layui-form-label"><span>*</span>库存数：</label>
			<div class="layui-input-inline">
				<input type="text" name="stock" placeholder="请输入库存数" autocomplete="off" class="layui-input" lay-verify="required" value="${data.stock!''}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>产品权重：</label>
			<div class="layui-input-inline">
				<input type="number" name="weight" placeholder="请输入产品权重越大越靠前" autocomplete="off" class="layui-input" value="${data.weight!''}">
			</div>
			<div class="layui-form-mid layui-word-aux">商品权重越大页面显示越靠前</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>供应商：</label>
			<div class="layui-input-inline">
				<select name="supplierId" lay-verify="required" lay-search>
					<option value="">请选择</option>
					<@module name="option" class="com.yuelinghui.label.impl.GetSupplierNode" type="2" checked="${data.supplierId!''}"/>
				</select>
				<!--<input type="hidden" name="supplierId" autocomplete="off" class="layui-input" id="supplier-id" value="${data.supplierId!''}">-->
				<!--<input type="text" name="supplierName" lay-verify="required" autocomplete="off" class="layui-input layui-inline" id="supplier-name" readonly value="${data.supplierName!''}">-->
				<!--<a href="javascript:void(0)" class="layui-btn layui-btn-small" id="add-supplier"></i>请选择</a>-->
			</div>
		</div>
		<div class="layui-form-item">
			<fieldset class="layui-elem-field layui-field-title">
				<legend><span style="color: red;">*</span>上传封面图片：</legend>
			</fieldset>
			<div class="layui-input-inline">
				<div class="layui-upload-drag" id="img-url">
					<#if data.imageUrl??>
					<input type='hidden' name='imageUrl' value="${data.imageUrl!''}"> <img width='200' src="${data.imageUrl!''}">
					<#else>
					<i class="layui-icon"></i>
					<p>点击上传</p>
					</#if>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<fieldset class="layui-elem-field layui-field-title">
				<legend><span style="color: red;">*</span>上传轮播图片：</legend>
			</fieldset>
			<button type="button" class="layui-btn" id="imglist-url" style="margin-left: 3px;">多图片上传</button>
			<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
				预览图：
				<div class="layui-upload-list" id="img-list">
					<#if data.imageList??>
					<#list data.imageList as img>
					<div class="layui-img-item">
						<img src="${img.url!''}" alt="img" class="layui-upload-img">
						<input type='hidden' value="${img.url!''}">
						<div class="layui-fun-list">
							<span class="del-img"><i class='layui-icon'>&#xe640;</i></span>
						</div>
					</div>
					</#list>
				</#if>
		        </div>
			</blockquote>
		</div>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">商品详情：</label>
			<div class="layui-input-block product-info">
				<textarea name ="info" style="display: none" id="goods-info">${data.info!''}</textarea>
			</div>
		</div>
		<div class="layui-form-item layui-fixed">
			<div class="layui-input-block">
				<button class="layui-btn" type="button" id="submit">立即提交</button>
				<button class="layui-btn layui-btn-primary" id="cancel">取消</button>
			</div>
		</div>
	</form>
</div>
<@footer>
<script>
    //入口
    layui.use(['laydate','upload','form'], function() {
        var $ = layui.jquery;
        var form = layui.form,laydate = layui.laydate,upload = layui.upload;

        //初始化一个编辑器
        var goodsInfoIndex = new Editor().init({
            editorEm: $('#goods-info'),	//产品介绍
            minHeight: 250
        })
        //多图片上传
        upload.render({
            elem: '#imglist-url'
            ,url: '${ctx}upload'
            ,multiple: true
            ,before: function(obj){
                var index = layer.msg('图片上传中...', {
                    icon: 16,
                    shade: 0.01,
                    time: 0
                })
            },done: function(res,index){
                layer.close(layer.msg());//关闭上传提示窗口
                //上传完毕
                var html = "";
                if (res.code == 0) {
                    html = "<div class='layui-img-item'>"
                        +"<img src="+ res.data[0] +" class='layui-upload-img'>"
                        +"<input type='hidden' value="+ res.data[0] +">"
                        +"<div class='layui-fun-list'>"
                        +"<span class='del-img'><i class='layui-icon'>&#xe640;</i></span>"
                        +"</div>"
                        +"</div>";
                }
                $('#img-list').append(html);
                //轮播图片删除
                $(".del-img").on('click',function () {
                    var $img = $(this).parent().parent();
                    $img.remove();
                });
            }
        });
        //轮播图片删除
        $(".del-img").on('click',function () {
            var $img = $(this).parent().parent();
            $img.remove();
        });
        //拖拽上传
        upload.render({
            elem: '#img-url'
            ,url: '${ctx}upload'
            ,done: function(res){
                var html = "<input type='hidden' name='imageUrl' value="+res.data[0]+"> <img width='200' src="+res.data[0]+">";
                $("#img-url").html(html)
            }
        });
        $("#submit").on('click', function(){
            var isEdit = false;
            //给轮播图片的隐藏表单设置name
            $(".layui-upload-list input").each(function (i) {
                $(this).attr("name","imageList["+i+"].url");
            })
            var content = goodsInfoIndex.getCode();
            if (content == "") {
                layer.msg("商品内容不能为空！")
                return;
            }
            $("#info").val(content);
            var formEm = $("#form-save").find('form');
            if(!form.onVerify(formEm)){
                return false;
            }
            var pid = $("#pid").val();
            var url = "add";
            if(pid != "") { //根据pid是否W为空判断是添加还是更新
                url = "edit"
                isEdit = true;
            }
            $.post(url,formEm.serialize(),function(result){
                if(result.code == 0){
                    formEm[0].reset();	//清空弹框表单内容
                    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);
                    parent.tools.searchData(isEdit);
                }
                layer.msg(result.msg);
            });
		});
        //添加供应商
        $('#add-supplier').on('click', function(){
            layer.open({
                type: 2,
                title: '选择供应商信息',
                shadeClose: true,
                shade: false,
                maxmin: true, //开启最大化最小化按钮
                resize: false,
                area: ['893px', '600px'],
                offset: '0px',
                content: 'supplierIndex'
            });
        });
        $("#cancel").on('click',function () {
            $("#form-save").find('form')[0].reset();
            closeWindow();
        });

        var _tools = {
            //获取选中的供应商信息
            setSupplier: function(supplierId,suppilerName){
                $("#supplier-id").val(supplierId);
                $("#supplier-name").val(suppilerName);
            }
        }
        var closeWindow = function () {
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            parent.layer.close(index);
            parent.tools.searchData();
        }
        window.tools = _tools
    });
</script>
</@footer>
<style type="text/css">
    .layui-elem-field legend {
        margin-left: 20px;
        padding: 0 10px;
        font-size: 12px;
        font-weight: 500;
    }
    .layui-form-item.layui-fixed {
        margin-top: 20px;
        position: fixed;
        right: 20px;
        bottom: 0px;
    }
</style>