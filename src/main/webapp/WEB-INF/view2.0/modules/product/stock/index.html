<#include "../../../_layout/_layout2.0.html"><#t>
<@header/>
<div class="admin-main">
	<!-- 筛选组 -->
	<blockquote class="layui-elem-quote filter-bar">
		<form class="layui-form" action="/table.html" id="filterForm">
			<div class="layui-inline">
				<label class="layui-filtrate-title">商品分类：</label>
				<input name="catId" id="catId" type="hidden">
				<div class="layui-input-inline">
					<select name="OneType" id="one-product-type" lay-filter="oneProductType">
						<option value="">全部</option>
						<@module name="option" class="com.logistics.label.impl.GetProductCategoryNode"/>
					</select>
				</div>
				<div class="layui-input-inline">
					<select name="TwoType" id="two-product-type" lay-filter="twoProductType">
						<option value="">全部</option>
					</select>
				</div>
			</div>
		    <div class="layui-inline">
		      <label class="layui-filtrate-title">商品编号：</label>
		      <div class="layui-input-inline">
		        <input type="text" name="pid" class="layui-input">
		      </div>
		    </div>
			<div class="layui-input-inline">
				<label class="layui-filtrate-title">仓库：</label>
				<div class="layui-input-inline">
					<select name="wid">
						<option value="">全部</option>
						<@module name="option" class="com.logistics.label.impl.GetWarehouseNode" />
					</select>
				</div>
			</div>
			<div class="layui-inline">
				<a href="javascript:void(0)" class="layui-btn layui-btn-sm operator-btn" data-type="search"><i class="layui-icon">&#xe615;</i>搜索</a>
				<a href="javascript:void(0)" class="layui-btn layui-btn-sm operator-btn" data-type="reset"><i class="layui-icon">&#x1002;</i>重置</a>
			</div>
		</form>
	</blockquote>
	<!-- 表格区域 -->
	<table id="product-stock-table" lay-filter="product-stock-table"></table>
</div>
<@footer>
<script>
//入口
layui.use(['table'], function(){
  var $ = layui.jquery;
  var table = layui.table,form = layui.form,common = layui.common;
    //常规用法
  //列表渲染
  var tableIns = table.render({
        id: 'product-stock-table',
        elem: '#product-stock-table'
        ,url: '${ctx}product/stock/list'
        ,height: 'full-140'
        ,page: true
        ,method: 'post'
        ,request: {
            pageName: 'pageNo' //页码的参数名称，默认：page
            ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
        }
        ,limits: [15,30,60,90,120]
        ,limit: 15 //默认采用30
        ,size: 'sm'
        ,cols: [[
            {checkbox: true, fixed: true}
            ,{fixed: true,field:'pid', title: '商品编号', width:155}
          	,{field:'productName', title: '商品名称', width:155}
            ,{field:'catName', title: '商品类型', width:120}
            ,{field:'wid', title: '仓库', width:155}
            ,{field:'stock', title: '库存', width:80}
            ,{field:'remaining', title: '剩余库存', width:120}
        ]],
    });
    // 获取分类数据

    //获取一级商品类型
    form.on('select(oneProductType)', function(data){
        var type = $(data.elem).find("option:selected").val() || $("#catId").val();
        $("#catId").val(type);
        getCatList(type,"two-product-type");
    });

    //获取二级商品类型
    form.on('select(twoProductType)', function(data){
        var type = $(data.elem).find("option:selected").val() || $("#catId").val();
        $("#catId").val(type);
    });

    // 获取产品类型
    var getCatList = function (type,id) {
        if (type == "") {
            return;
        }
        $("#"+id).empty();
        $.get("${ctx}product/getCatList",{type:type},function (result) {
            var html = "<option value=''>请选择</option>";
            layui.each(result.data,function (i,j) {
                console.log(j.name)
                html+="<option value='"+j.catId+"'>"+j.name+"</option>"
            })
            $("#"+id).append(html);
            form.render();
        })
    }

    //操作
    var active = {
        search: function () {
            dataReload();
        },
        reset: function () {
            $("#catId").val("");
            $("#filterForm")[0].reset();
            dataReload();
        }
    }
  //绑定操作按钮
  $('.operator-btn').on('click', function(){
	var type = $(this).data('type');
	active[type] ? active[type].call(this) : '';
  });
  //监听工具条
  table.on('tool(product-table)', function(obj){
	var type = obj.event;
	active[type] ? active[type].call(this, [obj.data]) : '';
  });
  //加载数据
  var dataReload = function (isEdit) {
  	if (isEdit) {
	  $(".layui-laypage-btn")[0].click();
	  return;
  	}
	tableIns.reload({
		where: common.formatForm($('#filterForm'))
	});
  }
});
</script>
</@footer>
<script type="text/html" id="timeTpl">
	{{# var fn = function(time){
	var newDate = new Date();
	newDate.setTime(time);
	return newDate.Format("yyyy-MM-dd hh:mm:ss");
	}
	}}
	{{fn(d.releaseTime)}}
</script>
