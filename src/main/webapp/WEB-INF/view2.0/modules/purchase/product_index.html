<#include "../../_layout/_layout2.0.html"><#t>
<@header/>
<div class="admin-main">
	<!-- 筛选组 -->
	<blockquote class="layui-elem-quote filter-bar">
		<form class="layui-form" action="/table.html" id="filterForm">
			<div class="layui-inline">
				<label class="layui-filtrate-title">商品分类：</label>
				<input name="catId" id="catId" type="hidden">
				<input name="productData" id="product-data" type="hidden">
				<div class="layui-input-inline" style="width: 120px;">
					<select name="oneType" id="one-product-type" lay-filter="oneProductType">
						<option value="">全部</option>
						<@module name="option" class="com.yuelinghui.label.impl.GetProductNode"/>
					</select>
				</div>
				<div class="layui-input-inline" style="width: 120px;">
					<select name="twoType" id="two-product-type" lay-filter="twoProductType">
						<option value="">全部</option>
					</select>
				</div>
				<div class="layui-input-inline" style="width: 120px;">
					<select name="threeType" id="three-product-type" lay-filter="threeProductType">
						<option value="">全部</option>
					</select>
				</div>
			</div>
			<div class="layui-inline">
				<label class="layui-filtrate-title">商品编号：</label>
				<div class="layui-input-inline">
					<input type="text" name="pid" class="layui-input">
				</div>
			</div>
			<div class="layui-inline">
				<a href="javascript:void(0)" class="layui-btn layui-btn-sm operator-btn" data-type="search"><i class="layui-icon">&#xe615;</i>搜索</a>
				<a href="javascript:void(0)" class="layui-btn layui-btn-sm operator-btn" data-type="reset"><i class="layui-icon">&#x1002;</i>重置</a>
			</div>
		</form>
	</blockquote>
	<!-- 表格区域 -->
	<table id="activity-table" lay-filter="activity-table"></table>
</div>
<@footer>
<script>
    //入口
    layui.use(['table','layer','form','laydate','common'], function(){
        var table = layui.table, layer = layui.layer, form = layui.form, laydate = layui.laydate,common = layui.common;
        form.render();
        //常规用法
        laydate.render({elem: '#activity-time',type: 'datetime',range: true});
		//获取一级商品类型
        form.on('select(oneProductType)', function(data){
            var type = $(data.elem).find("option:selected").val() || $("#catId").val();
            $("#catId").val(type);
            getCatList(type,"two-product-type");
        });

        //获取二级商品类型
        form.on('select(twoProductType)', function(data){
            var type = $(data.elem).find("option:selected").val() || $("#catId").val();
            $("#catId").val(type);
            getCatList(type,"three-product-type");
        });

        //获取三级商品类型
        form.on('select(threeProductType)', function(data){
            var type = $(data.elem).find("option:selected").val() || $("#catId").val();
            $("#catId").val(type);
        });

        // 获取产品类型
        var getCatList = function (type,id) {
            if (type == "") {
                return;
            }
            $("#"+id).empty();
            $.get("${ctx}vip/activity/getCatList",{type:type},function (result) {
                var html = "<option value=''>请选择</option>";
                layui.each(result.data,function (i,j) {
                    html+="<option value='"+j.catId+"'>"+j.name+"</option>"
                })
                $("#"+id).append(html);
                form.render();
            })
        }
        //列表渲染
        var tableIns = table.render({
			id: 'activity-table',
            elem: '#activity-table'
            ,url: '${ctx}vip/activity/productList'
            ,height: 'full-90'
            ,page: true
            ,method: 'post'
            ,request: {
                pageName: 'pageNo' //页码的参数名称，默认：page
                ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
            }
            ,limits: [15,30,60,90,120]
            ,limit: 15 //默认采用30
            ,size: 'sm'
            ,cols: [[
                {checkbox: true, fixed: true}
                ,{fixed: true,field:'pid', title: '商品编号', width:150}
                ,{field:'productTitle', title: '商品标题', width:250}
                ,{field:'productPrice', title: '售价', width:80}
                ,{field:'productOriginalPrice', title: '进货价', width:80,}
                ,{field:'stock', title: '剩余库存', width:120}
            ]],
        });
        //操作
        var active = {
            search: function () {
                dataReload();
            },
            reset: function () {
                $("#filterForm")[0].reset();
                $("#catId").val("");
                dataReload();
            }
        }
        //绑定操作按钮
        $('.operator-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
        //监听工具条
        table.on('checkbox(activity-table)', function(obj){
            var data = table.checkStatus('activity-table').data;
            $("#product-data").val(JSON.stringify(data))
        });
        //加载数据
        var dataReload = function (isEdit) {
            if (isEdit) {
                $(".layui-laypage-btn")[0].click();
                return;
            }
            tableIns.reload({
                where: common.formatForm($('#filterForm'))
            });
        }
    });
</script>
</@footer>