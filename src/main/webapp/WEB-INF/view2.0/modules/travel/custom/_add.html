<#include "../../../_layout/_layout2.0.html"><#t>
<@header/>
<div id="form-save" style="margin: 15px">
	<form name="custom-form" class="layui-form layui-form-pane" id="custom-form">
		<blockquote class="layui-elem-quote">客户信息：</blockquote>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>姓名：</label>
			<div class="layui-input-inline ">
				<input type="text" name="name" autocomplete="off" class="layui-input" lay-verify="required" value="${data.name!''}">
				<input name="mid" value="${data.mid!''}" id="mid" type="hidden">
			</div>
			<label class="layui-form-label"><span>*</span>联系方式：</label>
			<div class="layui-input-inline ">
				<input type="text" name="contact" autocomplete="off" class="layui-input" lay-verify="required" value="${data.contact!''}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>计划出行时间：</label>
			<div class="layui-input-inline ">
				<#if data.planTime??>
					<input type="text" name="planTime" placeholder="开始时间" id="plan-time" value="${data.planTime?string('yyyy-MM-dd HH:mm:ss')}"  class="layui-input" lay-verify="required">
					<#else>
					<input type="text" name="planTime" autocomplete="off" class="layui-input" lay-verify="required" id="plan-time">
				</#if>
			</div>
			<label class="layui-form-label"><span>*</span>出行天数：</label>
			<div class="layui-input-inline ">
				<input type="number" name="travelDay" autocomplete="off" class="layui-input" lay-verify="required" value="${data.travelDay!''}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>出发地：</label>
			<div class="layui-input-inline ">
				<input type="text" name="departure" autocomplete="off" class="layui-input" value="${data.departure!''}" lay-verify="required">
			</div>
			<label class="layui-form-label"><span>*</span>目的地：</label>
			<div class="layui-input-inline ">
				<input type="text" name="destination" autocomplete="off" class="layui-input" lay-verify="required" value="${data.destination!''}">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>出行人数：</label>
			<div class="layui-input-inline ">
				<input type="number" name="travelNumber" autocomplete="off" class="layui-input" lay-verify="required" value="${data.travelNumber!''}">
			</div>
			<label class="layui-form-label"><span>*</span>房间数：</label>
			<div class="layui-input-inline ">
				<input type="number" name="roomNumber" autocomplete="off" class="layui-input" value="${data.roomNumber!''}" lay-verify="required">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>人均预算：</label>
			<div class="layui-input-inline">
				<#if data.budget??>
					<input type="text" name="budget" autocomplete="off" class="layui-input" lay-verify="decimal" value="${data.budget?string('#.##')}">
					<#else>
					<input type="text" name="budget" autocomplete="off" class="layui-input" lay-verify="decimal" >
				</#if>
			</div>
		</div>
		<#if data.createTime??>
			<div class="layui-form-item">
				<label class="layui-form-label">提交时间：</label>
				<div class="layui-input-inline">
					<input type="text" readonly autocomplete="off" class="layui-input" lay-verify="required" value="${data.createTime?string('yyyy-MM-dd HH:mm:ss')}">
				</div>
				<label class="layui-form-label">客户来源：</label>
				<div class="layui-input-inline">
					<#if data.source?? && data.source == 1>
					<input type="text" readonly autocomplete="off" class="layui-input" value="独立开发">
					</#if>
					<#if data.source?? && data.source == 2>
						<input type="text" readonly autocomplete="off" class="layui-input" value="公众号">
					</#if>
				</div>
			</div>
		</#if>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">特殊需求：</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" class="layui-textarea" name="specialNeed">${data.specialNeed!''}</textarea>
			</div>
		</div>
		<blockquote class="layui-elem-quote">补充信息：</blockquote>
		<div class="layui-form-item">
			<div class="layui-form-item">
				<label class="layui-form-label">酒店级别：</label>
				<div class="layui-input-block">
					<input type="radio" name="hotelType"  title="顶级奢华" <#if data.hotelType??&&data.hotelType==1>checked</#if> value="1">
					<input type="radio" name="hotelType"  title="豪华尊贵" <#if data.hotelType??&&data.hotelType==2>checked</#if> value="2">
					<input type="radio" name="hotelType"  title="小型精品" <#if data.hotelType??&&data.hotelType==3>checked</#if> value="3">
				</div>
			</div>
		</div>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">补充备注：</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" class="layui-textarea" name="remark">${data.remark!''}</textarea>
			</div>
		</div>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">之前的处理记录：</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" class="layui-textarea" readonly>${data.operationLog!''}</textarea>
			</div>
		</div>
		<div class="layui-form-item layui-form-text">
			<label class="layui-form-label">处理记录：</label>
			<div class="layui-input-block">
				<textarea placeholder="请输入内容" class="layui-textarea" name="operationLog"></textarea>
			</div>
			<div class="layui-form-mid layui-word-aux">*填写处理定制旅游信息的记录</div>
		</div>
		<div class="layui-form-item">
			<button type="button" class="layui-btn layui-btn-primary" id="attachment"><i class="layui-icon"></i>上传附件</button>
			<#if data.attachment??>
				<input type="hidden" value="${data.attachment!''}" name="attachment"/>
				<a class="layui-btn" href="${data.attachment!''}" target="_blank">查看附件</a>
				<#else>
				<input type="hidden" name="attachment"/>
				<a class="layui-btn" target="_blank" style="display: none">查看附件</a>
			</#if>

		</div>
		<div class="layui-form-item">
			<div class="layui-input-block layui-form-save">
				<button class="layui-btn" id="custom" type="button">立即保存</button>
			</div>
		</div>
	</form>
</div>
<@footer>
<script>
	//入口
	layui.use(['element','form','upload','laydate'], function() {
        var element = layui.element,
			form = layui.form,
			$ = layui.jquery
            ,upload = layui.upload,
            laydate = layui.laydate;
        //自定义验证规则
        form.verify({
            decimal: function(value){
                if (value == "") {
                    return '个人预算不能为空！';
				}
                if(!/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(value)){
                    return '价格只能是整数或小数！';
                }
            }
        });
        //时间选择器
        laydate.render({
            elem: '#plan-time'
            ,type: 'datetime'
        });
        // 上传附件
        upload.render({ //允许上传的文件后缀
            elem: '#attachment'
            ,url: '${ctx}upload'
            ,accept: 'file' //普通文件
            ,size: 4096 //限制文件大小，单位 KB
            ,exts: 'doc|pdf|docx' //只允许上传压缩文件
			,before: function(obj){
                var index = layer.msg('图片上传中...', {
                    icon: 16,
                    shade: 0.01,
                    time: 0
                })
            },done: function(res){
                layer.close(layer.msg());//关闭上传提示窗口
                $("#attachment").parent().find("input[name = attachment]").attr("value",res.data);
                $("#attachment").parent().find("a").css("display","").attr("href",res.data);
            }
        });
        $("#custom").on('click',function () {
            var formEm = $("#custom-form");
            var mid = $("#mid").val();
            var url = "${ctx}travel/custom/add";
            if (mid != "") {
                url = "${ctx}travel/custom/edit";
			}
            $.post(url,formEm.serialize(),function(result){
                if(result.code == 0){
                    layer.msg("保存成功！");
                    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);
                    parent.custom_tool.searchData();
                    return;
                }
                layer.msg(result.msg);
            });
        })
    });
</script>
</@footer>
	<style type="text/css">
		.layui-form-save{
			text-align: center;
		}
		.layui-form-pane .layui-form-label{
			width: 130px;
		}
	</style>