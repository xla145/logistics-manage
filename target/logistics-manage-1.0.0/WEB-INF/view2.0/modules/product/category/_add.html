<#include "../../../_layout/_layout2.0.html"><#t>
<@header/>
<div  style="margin: 10px">
	<form name="product-category-form" class="layui-form layui-form-pane" id="product-category-form">
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>分类名称：</label>
			<div class="layui-input-inline ">
				<input type="text" name="name" autocomplete="off" class="layui-input" lay-verify="required" value="${data.name!''}">
				<input name="catId" value="${data.catId!''}" id="mid" type="hidden">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">上级分类</label>
			<input value="${data.parentId!''}" type="hidden" id="parentId">
			<div class="layui-input-inline">
				<select name="parentId" id="type" lay-search>
					<option value="0" selected="">顶级分类</option>
				</select>
			</div>
			<!--<div class="layui-input-inline">-->
				<!--<select name="parentId">-->
					<!--<option value="">请选择市</option>-->
					<!--<option value="杭州">杭州</option>-->
					<!--<option value="宁波" disabled="">宁波</option>-->
					<!--<option value="温州">温州</option>-->
					<!--<option value="温州">台州</option>-->
					<!--<option value="温州">绍兴</option>-->
				<!--</select>-->
			<!--</div>-->
			<div class="layui-form-mid layui-word-aux">最多成为第三级,如果设置为第二级, 只选择第一级即可</div>
		</div>
		<div class="layui-form-item">
			<fieldset class="layui-elem-field layui-field-title">
				<legend>上传图片：</legend>
			</fieldset>
			<div class="layui-input-inline">
				<div class="layui-upload-drag" id="img-url">
					<#if data.imgUrl??>
						<input type='hidden' name='imgUrl' value="${data.imgUrl!''}"> <img width='200' src="${data.imgUrl!''}">
						<#else>
							<i class="layui-icon"></i>
							<p>点击上传</p>
					</#if>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">是否显示</label>
			<div class="layui-input-block">
				<input type="checkbox" name="isShow" lay-skin="switch" lay-text="ON|OFF" value="1" <#if data.isShow?? && data.isShow == 1>checked</#if>>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label"><span>*</span>排序：</label>
			<div class="layui-input-inline ">
				<input type="number" name="weight" autocomplete="off" class="layui-input" lay-verify="required" value="${data.weight!''}">
			</div>
		</div>
	</form>
</div>
<@footer>
<script>
	//入口
	layui.use(['element','form','upload','laydate'], function() {
        var element = layui.element,
			form = layui.form,
			$ = layui.jquery
            ,upload = layui.upload,
            laydate = layui.laydate;
       var id = $("#type option:selected").val();
       var parentId = $("#parentId").val();
		$.get("${ctx}product/category/getItem",{id:id},function (result) {
			var html = "";
			layui.each(result.data,function (i,j) {
               if (parentId != "" && parentId == j.catId) {
                   html+="<option value='"+j.catId+"' selected>"+j.name+"</option>"
               } else {
                   html+="<option value='"+j.catId+"'>"+j.name+"</option>"
			   }
			})
			$("#type").append(html);
           form.render();
		})
        upload.render({
            elem: '#img-url'
            ,url: '${ctx}upload'
            ,size: 1024 //限制文件大小，单位 KB
			,before: function(obj){
				layer.msg('图片上传中...', {
					icon: 16,
					shade: 0.01,
					time: 0
				})}
            ,done: function(res){
                layer.close(layer.msg());//关闭上传提示窗口
                var html = "<input type='hidden' name='imgUrl' value="+res.data[0]+"> <img width='200' src="+res.data[0]+">";
                $("#img-url").html(html)
            }
        });
    });
</script>
</@footer>
